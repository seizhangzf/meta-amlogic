#@TYPE: Machine
#@NAME: meson

#@DESCRIPTION: Machine configuration for meson systems

#PREFERRED_PROVIDER_virtual/xserver ?= "xserver-xorg"
#XSERVER ?= "xserver-xorg \
#           xf86-input-evdev \
#           xf86-input-mouse \
#           xf86-video-fbdev \
#           xf86-input-keyboard"

#PREFERRED_PROVIDER_virtual/libgles1 = "libgles-fbdev-64b"
#PREFERRED_PROVIDER_virtual/libgles2 = "libgles-fbdev-64b"
#PREFERRED_PROVIDER_virtual/egl = "libgles-fbdev-64b"

include conf/machine/include/mesongxl.inc

MACHINE_ESSENTIAL_EXTRA_RRECOMMENDS += " \
        8189es \
        media-modules \
        optee-linux-driver \
        "

MACHINE_EXTRA_RRECOMMENDS = " kernel-modules kernel-devicetree"

EXTRA_IMAGEDEPENDS += "u-boot"

#include conf/machine/include/tune-cortexa53.inc
require conf/machine/include/arm/arch-armv8.inc
require conf/machine/include/amlogic.inc

#DEFAULTTUNE = "cortexa53_64-crypto"

IMAGE_FSTYPES += "tar.gz ext4 cpio.gz"
#IMAGE_FSTYPES += "cpio.gz.u-boot"
#IMAGE_CLASSES += "image_types_uboot"

IMAGE_FSTYPES_DEBUGFS = ""

SERIAL_CONSOLE = "115200 ttyS0"

PREFERRED_PROVIDER_virtual/kernel ?= "linux-meson"

KERNEL_IMAGETYPE = "Image.gz"
KERNEL_DEVICETREE = "gxl_p212_1g_buildroot.dtb"

UBOOT_SUFFIX = "bin"
UBOOT_MACHINE = "gxl_p212_v1_config"

MACHINE_FEATURES = "usbgadget usbhost vfat alsa"

IMAGE_BOOT_FILES ?= "u-boot.${UBOOT_SUFFIX}"

INITRAMFS_FILES = "initramfs-default"

KERNEL_MODULE_AUTOLOAD += "mali 8189es"
# append drm(wayland drm backend)
DISTRO_FEATURES_append = " drm"

OVERRIDES .= ":p212:gxl"

PREFERRED_PROVIDER_virtual/gpu ?= "mali450"
