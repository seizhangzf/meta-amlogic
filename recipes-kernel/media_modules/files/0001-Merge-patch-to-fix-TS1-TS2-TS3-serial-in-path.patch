From 6ae21e62aa7aa85a3dea0dd84fd23099332442c6 Mon Sep 17 00:00:00 2001
From: Pradeep Sriram <pradeep.sriram@amlogic.com>
Date: Mon, 14 Oct 2019 15:45:27 -0700
Subject: [PATCH]  Merge patch to fix TS1/TS2/TS3 serial-in path  has trouble.
 Patch is from http://scgit.amlogic.com:8080/#/c/72671/

---
 drivers/stream_input/parser/hw_demux/aml_dmx.c | 12 ++++++------
 drivers/stream_input/parser/hw_demux/aml_dvb.h |  1 +
 2 files changed, 7 insertions(+), 6 deletions(-)

diff --git a/drivers/stream_input/parser/hw_demux/aml_dmx.c b/drivers/stream_input/parser/hw_demux/aml_dmx.c
index b82984f..a02d8ee 100644
--- a/drivers/stream_input/parser/hw_demux/aml_dmx.c
+++ b/drivers/stream_input/parser/hw_demux/aml_dmx.c
@@ -3079,8 +3079,8 @@ static int dmx_enable(struct aml_dmx *dmx)
 		pr_dbg("dsc2 ctrl: 0x%x\n", READ_MPEG_REG(COMM_DESC_2_CTL));
 	}
 
-	pr_dbg("[dmx-%d]src: %d, rec: %d, hi_bsf: %d, dsc: %d\n",
-	       dmx->id, dmx->source, record, hi_bsf, fec_core_sel);
+	pr_dbg("[dmx-%d]src: %d, rec: %d, hi_bsf: %d,fec_sel:%d dsc: %d,fec_ctrl:%d\n",
+	       dmx->id, dmx->source, record, hi_bsf, fec_sel, fec_core_sel,fec_ctrl);
 
 	if (dmx->chan_count) {
 		if (set_stb) {
@@ -4872,22 +4872,22 @@ int aml_dmx_hw_set_source(struct dmx_demux *demux, dmx_source_t src)
 	case DMX_SOURCE_FRONT0:
 		hw_src =
 		    (dvb->ts[0].mode ==
-		     AM_TS_SERIAL) ? (dvb->ts[0].s2p_id + AM_TS_SRC_S_TS0) : AM_TS_SRC_TS0;
+		     AM_TS_SERIAL) ? AM_TS_SRC_S_TS0 : AM_TS_SRC_TS0;
 		break;
 	case DMX_SOURCE_FRONT1:
 		hw_src =
 		    (dvb->ts[1].mode ==
-		     AM_TS_SERIAL) ? (dvb->ts[1].s2p_id + AM_TS_SRC_S_TS0) : AM_TS_SRC_TS1;
+		     AM_TS_SERIAL) ? AM_TS_SRC_S_TS1 : AM_TS_SRC_TS1;
 		break;
 	case DMX_SOURCE_FRONT2:
 		hw_src =
 		    (dvb->ts[2].mode ==
-		     AM_TS_SERIAL) ? (dvb->ts[2].s2p_id + AM_TS_SRC_S_TS0) : AM_TS_SRC_TS2;
+		     AM_TS_SERIAL) ? AM_TS_SRC_S_TS2 : AM_TS_SRC_TS2;
 		break;
 	case DMX_SOURCE_FRONT3:
 		hw_src =
 			(dvb->ts[3].mode ==
-			 AM_TS_SERIAL) ? (dvb->ts[3].s2p_id + AM_TS_SRC_S_TS0) : AM_TS_SRC_TS3;
+		     AM_TS_SERIAL) ? AM_TS_SRC_S_TS3 : AM_TS_SRC_TS3;
 		break;
 	case DMX_SOURCE_DVR0:
 		hw_src = AM_TS_SRC_HIU;
diff --git a/drivers/stream_input/parser/hw_demux/aml_dvb.h b/drivers/stream_input/parser/hw_demux/aml_dvb.h
index 50ad862..604be3a 100644
--- a/drivers/stream_input/parser/hw_demux/aml_dvb.h
+++ b/drivers/stream_input/parser/hw_demux/aml_dvb.h
@@ -92,6 +92,7 @@ enum aml_ts_source_t {
 	AM_TS_SRC_S_TS0,
 	AM_TS_SRC_S_TS1,
 	AM_TS_SRC_S_TS2,
+	AM_TS_SRC_S_TS3,
 
 	AM_TS_SRC_HIU,
 	AM_TS_SRC_HIU1,
-- 
2.7.4

