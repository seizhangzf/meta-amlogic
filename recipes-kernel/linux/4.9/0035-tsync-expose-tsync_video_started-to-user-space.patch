From af854c3639eecfc1ef6d9cedbc1022e4c72a593c Mon Sep 17 00:00:00 2001
From: Mingyen Hung <mingyen.hung@amlogic.com>
Date: Tue, 23 Apr 2019 14:56:56 +0800
Subject: [PATCH] =?UTF-8?q?tsync:=20expose=20tsync=5Fvideo=5Fstarted=20to?=
 =?UTF-8?q?=20user=20space=E2=86=B5?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

When slowsync_enable is 1, pcrscr will be reset↵
due to VIDEO_START event. This make pcrscr unstable.↵

Expose this value will make apps in userspace know↵
when pcrscr is stable to fetch.↵

Signed-off-by: Mingyen Hung <mingyen.hung@amlogic.com>↵
---
 drivers/amlogic/media/frame_sync/tsync.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/drivers/amlogic/media/frame_sync/tsync.c b/drivers/amlogic/media/frame_sync/tsync.c
index 170584a2435f..3880c2d89ef5 100644
--- a/drivers/amlogic/media/frame_sync/tsync.c
+++ b/drivers/amlogic/media/frame_sync/tsync.c
@@ -1947,6 +1947,12 @@ static ssize_t show_checkin_firstapts(struct class *class,
 	return sprintf(buf, "0x%x\n", timestamp_checkin_firstapts_get());
 }
 
+static ssize_t show_tsync_video_started(struct class *class,
+		struct class_attribute *attr, char *buf)
+{
+	return sprintf(buf, "0x%x\n", tsync_video_started);
+}
+
 static ssize_t show_vpause_flag(struct class *class,
 		struct class_attribute *attr, char *buf)
 {
@@ -2107,6 +2113,8 @@ static struct class_attribute tsync_class_attrs[] = {
 	NULL),
 	__ATTR(checkin_firstapts, 0644, show_checkin_firstapts,
 	NULL),
+	__ATTR(tsync_video_started, 0444, show_tsync_video_started,
+	NULL),
 	__ATTR(pts_latency, 0664, show_latency, store_latency),
 	__ATTR_NULL
 };
-- 
2.11.0

