From a3b80d5bf127c59f23a610fab5ad265ed2583bf8 Mon Sep 17 00:00:00 2001
From: Pradeep Sriram <pradeep.sriram@amlogic.com>
Date: Wed, 6 May 2020 21:50:31 -0700
Subject: [PATCH] RDK: Customize DTS files [1/1]

PD#SWPL-25661

Problem:
  Need to customize DTS file RDK Project

Solution:
  Customize DTS file for RDK
  AB311
  AB301
  U212

Verify:
  u212

Change-Id: I7b18402ba2a55ee80cb704fb791e5b03791e74ca
Signed-off-by: Pradeep Sriram <pradeep.sriram@amlogic.com>
---
 .../g12a_s905x2_u212_drm_buildroot.dts        | 100 +-------------
 .../amlogic/partition_mbox_normal_P_rdk.dtsi  | 122 ++++++++++++++++++
 .../boot/dts/amlogic/partition_tv_ab_rdk.dtsi | 106 +++++++++++++++
 .../tm2_revb_t962e2_ab311_drm_buildroot.dts   |   8 +-
 .../tm2_revb_t962x3_ab301_drm_buildroot.dts   |   8 +-
 .../tm2_t962e2_ab311_drm_buildroot.dts        |   8 +-
 .../tm2_t962x3_ab301_drm_buildroot.dts        |   8 +-
 7 files changed, 251 insertions(+), 109 deletions(-)
 create mode 100644 arch/arm/boot/dts/amlogic/partition_mbox_normal_P_rdk.dtsi
 create mode 100644 arch/arm/boot/dts/amlogic/partition_tv_ab_rdk.dtsi

diff --git a/arch/arm/boot/dts/amlogic/g12a_s905x2_u212_drm_buildroot.dts b/arch/arm/boot/dts/amlogic/g12a_s905x2_u212_drm_buildroot.dts
index 94ddce32e55a..69421777ecc8 100644
--- a/arch/arm/boot/dts/amlogic/g12a_s905x2_u212_drm_buildroot.dts
+++ b/arch/arm/boot/dts/amlogic/g12a_s905x2_u212_drm_buildroot.dts
@@ -19,6 +19,7 @@
 
 #include "mesong12a.dtsi"
 #include "mesong12a_drm.dtsi"
+#include "partition_mbox_normal_P_rdk.dtsi"
 
 / {
 	model = "Amlogic";
@@ -75,7 +76,7 @@
 		ion_cma_reserved:linux,ion-dev {
 			compatible = "shared-dma-pool";
 			reusable;
-			size = <0x8000000>;
+			size = <0xC800000>;
 			alignment = <0x400000>;
 		};
 		//di_reserved:linux,di {
@@ -112,8 +113,9 @@
 			compatible = "shared-dma-pool";
 			reusable;
 			/* ion_codec_mm max can alloc size 80M*/
-			size = <0x13400000>;
+			size = <0x18400000>;
 			alignment = <0x400000>;
+			alloc-ranges = <0x0 0x30000000>;
 			linux,contiguous-region;
 		};
 		/* codec shared reserved */
@@ -280,94 +282,6 @@
 	};
 
 
-	partitions: partitions{
-		parts = <14>;
-		part-0 = <&logo>;
-		part-1 = <&recovery>;
-		part-2 = <&misc>;
-		part-3 = <&dto>;
-		part-4 = <&cri_data>;
-		part-5 = <&param>;
-		part-6 = <&boot>;
-		part-7 = <&rsv>;
-		part-8 = <&tee>;
-		part-9 = <&vendor>;
-		part-10 = <&odm>;
-		part-11 = <&system>;
-		part-12 = <&cache>;
-		part-13 = <&data>;
-
-		logo:logo{
-			pname = "logo";
-			size = <0x0 0x800000>;
-			mask = <1>;
-		};
-		recovery:recovery{
-			pname = "recovery";
-			size = <0x0 0x1800000>;
-			mask = <1>;
-		};
-		misc:misc{
-			pname = "misc";
-			size = <0x0 0x800000>;
-			mask = <1>;
-		};
-		dto:dto{
-			pname = "dto";
-			size = <0x0 0x800000>;
-			mask = <1>;
-		};
-		cri_data:cri_data{
-			pname = "cri_data";
-			size = <0x0 0x800000>;
-			mask = <2>;
-		};
-		rsv:rsv{
-			pname = "rsv";
-			size = <0x0 0x1000000>;
-			mask = <1>;
-		};
-		param:param{
-			pname = "param";
-			size = <0x0 0x1000000>;
-			mask = <2>;
-		};
-		boot:boot{
-			pname = "boot";
-			size = <0x0 0x1000000>;
-			mask = <1>;
-		};
-		tee:tee{
-			pname = "tee";
-			size = <0x0 0x2000000>;
-			mask = <1>;
-		};
-		vendor:vendor{
-			pname = "vendor";
-			size = <0x0 0x10000000>;
-			mask = <1>;
-		};
-		odm:odm{
-			pname = "odm";
-			size = <0x0 0x10000000>;
-			mask = <1>;
-		};
-		system:system{
-			pname = "system";
-			size = <0x0 0x80000000>;
-			mask = <1>;
-		};
-		cache:cache{
-			pname = "cache";
-			size = <0x0 0x46000000>;
-			mask = <2>;
-		};
-		data:data{
-			pname = "data";
-			size = <0xffffffff 0xffffffff>;
-			mask = <4>;
-		};
-	};
 	unifykey{
 		compatible = "amlogic, unifykey";
 		status = "ok";
@@ -631,9 +545,9 @@
 			suffix-name = "alsaPORT-i2s";
 			cpu {
 				sound-dai = <&aml_tdmb>;
-				dai-tdm-slot-tx-mask = <1 1>;
-				dai-tdm-slot-rx-mask = <1 1>;
-				dai-tdm-slot-num = <2>;
+                dai-tdm-slot-tx-mask = <1 1 1 1 1 1 1 1>;
+                dai-tdm-slot-rx-mask = <1 1 1 1 1 1 1 1>;
+                dai-tdm-slot-num = <8>;
 				/*
 				 * dai-tdm-slot-tx-mask =
 				 *	<1 1 1 1 1 1 1 1>;
diff --git a/arch/arm/boot/dts/amlogic/partition_mbox_normal_P_rdk.dtsi b/arch/arm/boot/dts/amlogic/partition_mbox_normal_P_rdk.dtsi
new file mode 100644
index 000000000000..0a2daae77346
--- /dev/null
+++ b/arch/arm/boot/dts/amlogic/partition_mbox_normal_P_rdk.dtsi
@@ -0,0 +1,122 @@
+﻿ /*
+  * Amlogic partition set for normal
+  *
+  * Copyright (c) 2017-2017 Amlogic Ltd
+  *
+  * This file is licensed under a dual GPLv2 or BSD license.
+  *
+  */
+
+/ {
+	partitions: partitions{
+				parts = <18>;
+				part-0 = <&dtbbak>;
+				part-1 = <&bootloaderbak>;
+				part-2 = <&recovery>;
+				part-3 = <&logo>;
+				part-4 = <&misc>;
+				part-5 = <&cri_data>;
+				part-6 = <&rsv>;
+				part-7 = <&param>;
+				part-8 = <&tee>;
+				part-9 = <&oem>;
+				part-10 = <&vbmeta_a>;
+				part-11 = <&boot_a>;
+				part-12 = <&system_a>;
+				part-13 = <&vbmeta_b>;
+				part-14 = <&boot_b>;
+				part-15 = <&system_b>;
+				part-16 = <&cache>;
+				part-17 = <&data>;
+		dtbbak:dtbbak{
+				   pname = "dtbbak";
+				   size = <0x0 0x100000>;
+				   mask = <1>;
+			   };
+		bootloaderbak:bootloaderbak{
+						  pname = "bootloaderbak";
+						  size = <0x0 0x200000>;
+						  mask = <1>;
+					  };
+		recovery:recovery{
+					 pname = "recovery";
+					 size = <0x0 0x4000000>;
+					 mask = <1>;
+				 };
+		logo:logo{
+				 pname = "logo";
+				 size = <0x0 0x800000>;
+				 mask = <1>;
+			 };
+		misc:misc{
+				 pname = "misc";
+				 size = <0x0 0x200000>;
+				 mask = <1>;
+			 };
+		cri_data:cri_data {
+					 pname = "cri_data";
+					 size = <0x0 0x400000>;
+					 mask = <2>;
+				 };
+		rsv:rsv{
+				pname = "rsv";
+				size = <0x0 0x1000000>;
+				mask = <1>;
+			};
+		param:param{
+				  pname = "param";
+				  size = <0x0 0x1000000>;
+				  mask = <2>;
+			  };
+		tee:tee{
+				pname = "tee";
+				size = <0x0 0x2000000>;
+				mask = <1>;
+			};
+		oem:oem{
+				pname = "oem";
+				size = <0x0 0x800000>;
+				mask = <1>;
+			};
+		vbmeta_a:vbmeta_a{
+					 pname = "vbmeta_a";
+					 size = <0x0 0x200000>;
+					 mask = <1>;
+				 };
+		boot_a:boot_a {
+				   pname = "boot_a";
+				   size = <0x0 0x1000000>;
+				   mask = <1>;
+			   };
+		system_a:system_a {
+					 pname = "system_a";
+					 size = <0x0 0x96000000>;
+					 mask = <1>;
+				 };
+		vbmeta_b:vbmeta_b {
+					 pname = "vbmeta_b";
+					 size = <0x0 0x200000>;
+					 mask = <1>;
+				 };
+		boot_b:boot_b {
+				   pname = "boot_b";
+				   size = <0x0 0x1000000>;
+				   mask = <1>;
+			   };
+		system_b:system_b {
+					 pname = "system_b";
+					 size = <0x0 0x96000000>;
+					 mask = <1>;
+				 };
+		cache:cache {
+				  pname = "cache";
+				  size = <0x0 0xC800000>;
+				  mask = <2>;
+			  };
+		data:data {
+		 pname = "data";
+		 size = <0xffffffff 0xffffffff>;
+		 mask = <4>;
+	 };
+			};
+};/* end of / */
diff --git a/arch/arm/boot/dts/amlogic/partition_tv_ab_rdk.dtsi b/arch/arm/boot/dts/amlogic/partition_tv_ab_rdk.dtsi
new file mode 100644
index 000000000000..b6f0b8efad73
--- /dev/null
+++ b/arch/arm/boot/dts/amlogic/partition_tv_ab_rdk.dtsi
@@ -0,0 +1,106 @@
+﻿ /*
+  * Amlogic partition set for normal
+  *
+  * Copyright (c) 2017-2017 Amlogic Ltd
+  *
+  * This file is licensed under a dual GPLv2 or BSD license.
+  *
+  */
+
+/ {
+	partitions: partitions{
+				parts = <15>;
+				part-0 = <&recovery>;
+				part-1 = <&logo>;
+				part-2 = <&misc>;
+				part-3 = <&cri_data>;
+				part-4 = <&rsv>;
+				part-5 = <&param>;
+				part-6 = <&tee>;
+				part-7 = <&vendor>;
+				part-8 = <&vbmeta_a>;
+				part-9 = <&boot_a>;
+				part-10 = <&system_a>;
+				part-11 = <&vbmeta_b>;
+				part-12 = <&boot_b>;
+				part-13 = <&system_b>;
+				part-14 = <&data>;
+		recovery:recovery{
+					 pname = "recovery";
+					 size = <0x0 0x4000000>;
+					 mask = <1>;
+				 };
+		logo:logo{
+				 pname = "logo";
+				 size = <0x0 0x800000>;
+				 mask = <1>;
+			 };
+		misc:misc{
+				 pname = "misc";
+				 size = <0x0 0x200000>;
+				 mask = <1>;
+			 };
+		cri_data:cri_data {
+					 pname = "cri_data";
+					 size = <0x0 0x400000>;
+					 mask = <2>;
+				 };
+		rsv:rsv{
+				pname = "rsv";
+				size = <0x0 0x1000000>;
+				mask = <1>;
+			};
+		param:param{
+				  pname = "param";
+				  size = <0x0 0x1000000>;
+				  mask = <2>;
+			  };
+		tee:tee{
+				pname = "tee";
+				size = <0x0 0x2000000>;
+				mask = <1>;
+			};
+		vendor:vendor
+		{
+			pname = "vendor";
+			size = <0x0 0x14000000>;
+			mask = <1>;
+		};
+
+		vbmeta_a:vbmeta_a{
+					 pname = "vbmeta_a";
+					 size = <0x0 0x200000>;
+					 mask = <1>;
+				 };
+		boot_a:boot_a {
+				   pname = "boot_a";
+				   size = <0x0 0x1000000>;
+				   mask = <1>;
+			   };
+		system_a:system_a {
+					 pname = "system_a";
+					 size = <0x0 0x96000000>;
+					 mask = <1>;
+				 };
+		vbmeta_b:vbmeta_b {
+					 pname = "vbmeta_b";
+					 size = <0x0 0x200000>;
+					 mask = <1>;
+				 };
+		boot_b:boot_b {
+				   pname = "boot_b";
+				   size = <0x0 0x1000000>;
+				   mask = <1>;
+			   };
+		system_b:system_b {
+					 pname = "system_b";
+					 size = <0x0 0x96000000>;
+					 mask = <1>;
+				 };
+		data:data {
+		 pname = "data";
+		 size = <0xffffffff 0xffffffff>;
+		 mask = <4>;
+	 };
+			};
+};/* end of / */
diff --git a/arch/arm/boot/dts/amlogic/tm2_revb_t962e2_ab311_drm_buildroot.dts b/arch/arm/boot/dts/amlogic/tm2_revb_t962e2_ab311_drm_buildroot.dts
index b12df35ca6d1..e54c143dc6a5 100644
--- a/arch/arm/boot/dts/amlogic/tm2_revb_t962e2_ab311_drm_buildroot.dts
+++ b/arch/arm/boot/dts/amlogic/tm2_revb_t962e2_ab311_drm_buildroot.dts
@@ -19,7 +19,7 @@
 
 #include "mesontm2_revb.dtsi"
 #include "mesontm2_drm.dtsi"
-#include "partition_mbox_normal_P_32.dtsi"
+#include "partition_tv_ab_rdk.dtsi"
 
 / {
 	model = "Amlogic TM2 REVB T962E2 AB311";
@@ -82,10 +82,10 @@
 			compatible = "shared-dma-pool";
 			reusable;
 			/* ion_codec_mm max can alloc size 80M*/
-			size = <0x13400000>;
+			size = <0x18400000>;
 			alignment = <0x400000>;
 			linux,contiguous-region;
-			alloc-ranges = <0x31000000 0x13400000>;
+			alloc-ranges = <0x0 0x30000000>;
 		};
 
 		/* codec shared reserved */
@@ -99,7 +99,7 @@
 		ion_cma_reserved:linux,ion-dev {
 			compatible = "shared-dma-pool";
 			reusable;
-			size = <0x2000000>;
+			size = <0xC800000>;
 			alignment = <0x400000>;
 		};
 
diff --git a/arch/arm/boot/dts/amlogic/tm2_revb_t962x3_ab301_drm_buildroot.dts b/arch/arm/boot/dts/amlogic/tm2_revb_t962x3_ab301_drm_buildroot.dts
index b7c9ad4f1c7d..9c863ffe6c11 100644
--- a/arch/arm/boot/dts/amlogic/tm2_revb_t962x3_ab301_drm_buildroot.dts
+++ b/arch/arm/boot/dts/amlogic/tm2_revb_t962x3_ab301_drm_buildroot.dts
@@ -19,7 +19,7 @@
 
 #include "mesontm2_revb.dtsi"
 #include "mesontm2_drm.dtsi"
-#include "partition_mbox_normal_P_32.dtsi"
+#include "partition_tv_ab_rdk.dtsi"
 #include "mesontm2_revb_t962x3_ab301-panel.dtsi"
 
 / {
@@ -91,10 +91,10 @@
 			compatible = "shared-dma-pool";
 			reusable;
 			/* ion_codec_mm max can alloc size 80M*/
-			size = <0x13400000>;
+			size = <0x18400000>;
 			alignment = <0x400000>;
 			linux,contiguous-region;
-			alloc-ranges = <0x30000000 0x50000000>;
+			alloc-ranges = <0x0 0x30000000>;
 		};
 
 		/* codec shared reserved */
@@ -108,7 +108,7 @@
 		ion_cma_reserved:linux,ion-dev {
 			compatible = "shared-dma-pool";
 			reusable;
-			size = <0x2000000>;
+			size = <0xC800000>;
 			alignment = <0x400000>;
 		};
 
diff --git a/arch/arm/boot/dts/amlogic/tm2_t962e2_ab311_drm_buildroot.dts b/arch/arm/boot/dts/amlogic/tm2_t962e2_ab311_drm_buildroot.dts
index c0e1204ae572..c6159a96a3fb 100644
--- a/arch/arm/boot/dts/amlogic/tm2_t962e2_ab311_drm_buildroot.dts
+++ b/arch/arm/boot/dts/amlogic/tm2_t962e2_ab311_drm_buildroot.dts
@@ -19,7 +19,7 @@
 
 #include "mesontm2.dtsi"
 #include "mesontm2_drm.dtsi"
-#include "partition_mbox_normal.dtsi"
+#include "partition_tv_ab_rdk.dtsi"
 
 / {
 	model = "Amlogic TM2 T962E2 AB311";
@@ -82,10 +82,10 @@
 			compatible = "shared-dma-pool";
 			reusable;
 			/* ion_codec_mm max can alloc size 80M*/
-			size = <0x13400000>;
+			size = <0x18400000>;
 			alignment = <0x400000>;
 			linux,contiguous-region;
-			alloc-ranges = <0x30000000 0x50000000>;
+			alloc-ranges = <0x0 0x30000000>;
 		};
 
 		/* codec shared reserved */
@@ -99,7 +99,7 @@
 		ion_cma_reserved:linux,ion-dev {
 			compatible = "shared-dma-pool";
 			reusable;
-			size = <0x2000000>;
+			size = <0xC800000>;
 			alignment = <0x400000>;
 		};
 
diff --git a/arch/arm/boot/dts/amlogic/tm2_t962x3_ab301_drm_buildroot.dts b/arch/arm/boot/dts/amlogic/tm2_t962x3_ab301_drm_buildroot.dts
index 4b047b839767..fbde4e0e8724 100644
--- a/arch/arm/boot/dts/amlogic/tm2_t962x3_ab301_drm_buildroot.dts
+++ b/arch/arm/boot/dts/amlogic/tm2_t962x3_ab301_drm_buildroot.dts
@@ -19,7 +19,7 @@
 
 #include "mesontm2.dtsi"
 #include "mesontm2_drm.dtsi"
-#include "partition_mbox_normal.dtsi"
+#include "partition_tv_ab_rdk.dtsi"
 #include "mesontm2_t962x3_ab301-panel.dtsi"
 
 / {
@@ -91,10 +91,10 @@
 			compatible = "shared-dma-pool";
 			reusable;
 			/* ion_codec_mm max can alloc size 80M*/
-			size = <0x13400000>;
+			size = <0x18400000>;
 			alignment = <0x400000>;
 			linux,contiguous-region;
-			alloc-ranges = <0x30000000 0x50000000>;
+			alloc-ranges = <0x0 0x30000000>;
 		};
 
 		/* codec shared reserved */
@@ -108,7 +108,7 @@
 		ion_cma_reserved:linux,ion-dev {
 			compatible = "shared-dma-pool";
 			reusable;
-			size = <0x2000000>;
+			size = <0xC800000>;
 			alignment = <0x400000>;
 		};
 
-- 
2.24.1

