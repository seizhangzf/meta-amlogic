From 24aa058d26b70ae8146e1cc1fa631da8905dd253 Mon Sep 17 00:00:00 2001
From: "johnny.lee" <johnny.lee@amlogic.com>
Date: Tue, 10 Mar 2020 17:37:32 -0700
Subject: [PATCH] to support absystem and remove unnecessary partitions

---
 .../g12a_s905x2_u212_drm_buildroot.dts        | 89 +------------------
 .../amlogic/partition_mbox_normal_P_32.dtsi   | 76 +++++++---------
 .../arm/boot/dts/amlogic/tm2_t962e2_ab311.dts |  2 +-
 .../boot/dts/amlogic/tm2_t962e2_ab311_drm.dts |  2 +-
 .../arm/boot/dts/amlogic/tm2_t962x3_ab301.dts |  2 +-
 .../tm2_t962x3_ab301_drm_buildroot.dts        |  2 +-
 6 files changed, 37 insertions(+), 136 deletions(-)

diff --git a/arch/arm/boot/dts/amlogic/g12a_s905x2_u212_drm_buildroot.dts b/arch/arm/boot/dts/amlogic/g12a_s905x2_u212_drm_buildroot.dts
index a538070b3fd5..1009cc5423bc 100644
--- a/arch/arm/boot/dts/amlogic/g12a_s905x2_u212_drm_buildroot.dts
+++ b/arch/arm/boot/dts/amlogic/g12a_s905x2_u212_drm_buildroot.dts
@@ -19,6 +19,7 @@
 
 #include "mesong12a.dtsi"
 #include "mesong12a_drm.dtsi"
+#include "partition_mbox_normal_P_32.dtsi"
 
 / {
 	model = "Amlogic";
@@ -280,94 +281,6 @@
 	};
 
 
-	partitions: partitions{
-		parts = <14>;
-		part-0 = <&logo>;
-		part-1 = <&recovery>;
-		part-2 = <&misc>;
-		part-3 = <&dto>;
-		part-4 = <&cri_data>;
-		part-5 = <&param>;
-		part-6 = <&boot>;
-		part-7 = <&rsv>;
-		part-8 = <&tee>;
-		part-9 = <&vendor>;
-		part-10 = <&odm>;
-		part-11 = <&system>;
-		part-12 = <&cache>;
-		part-13 = <&data>;
-
-		logo:logo{
-			pname = "logo";
-			size = <0x0 0x800000>;
-			mask = <1>;
-		};
-		recovery:recovery{
-			pname = "recovery";
-			size = <0x0 0x1800000>;
-			mask = <1>;
-		};
-		misc:misc{
-			pname = "misc";
-			size = <0x0 0x800000>;
-			mask = <1>;
-		};
-		dto:dto{
-			pname = "dto";
-			size = <0x0 0x800000>;
-			mask = <1>;
-		};
-		cri_data:cri_data{
-			pname = "cri_data";
-			size = <0x0 0x800000>;
-			mask = <2>;
-		};
-		rsv:rsv{
-			pname = "rsv";
-			size = <0x0 0x1000000>;
-			mask = <1>;
-		};
-		param:param{
-			pname = "param";
-			size = <0x0 0x1000000>;
-			mask = <2>;
-		};
-		boot:boot{
-			pname = "boot";
-			size = <0x0 0x1000000>;
-			mask = <1>;
-		};
-		tee:tee{
-			pname = "tee";
-			size = <0x0 0x2000000>;
-			mask = <1>;
-		};
-		vendor:vendor{
-			pname = "vendor";
-			size = <0x0 0x10000000>;
-			mask = <1>;
-		};
-		odm:odm{
-			pname = "odm";
-			size = <0x0 0x10000000>;
-			mask = <1>;
-		};
-		system:system{
-			pname = "system";
-			size = <0x0 0x80000000>;
-			mask = <1>;
-		};
-		cache:cache{
-			pname = "cache";
-			size = <0x0 0x46000000>;
-			mask = <2>;
-		};
-		data:data{
-			pname = "data";
-			size = <0xffffffff 0xffffffff>;
-			mask = <4>;
-		};
-	};
 	unifykey{
 		compatible = "amlogic, unifykey";
 		status = "ok";
diff --git a/arch/arm/boot/dts/amlogic/partition_mbox_normal_P_32.dtsi b/arch/arm/boot/dts/amlogic/partition_mbox_normal_P_32.dtsi
index 6cbedc415e4f..52545cab62ee 100644
--- a/arch/arm/boot/dts/amlogic/partition_mbox_normal_P_32.dtsi
+++ b/arch/arm/boot/dts/amlogic/partition_mbox_normal_P_32.dtsi
@@ -11,32 +11,30 @@
 
 / {
     partitions: partitions{
-		parts = <17>;
+		parts = <15>;
 		part-0 = <&logo>;
-		part-1 = <&recovery>;
+		part-1 = <&recovery_a>;
 		part-2 = <&misc>;
-		part-3 = <&dtbo>;
-		part-4 = <&cri_data>;
-		part-5 = <&param>;
-		part-6 = <&boot>;
-		part-7 = <&rsv>;
-		part-8 = <&metadata>;
-		part-9 = <&vbmeta>;
-		part-10 = <&tee>;
-		part-11 = <&vendor>;
-		part-12 = <&odm>;
-		part-13 = <&system>;
-		part-14 = <&product>;
-		part-15 = <&cache>;
-		part-16 = <&data>;
+		part-3 = <&cri_data>;
+		part-4 = <&param>;
+		part-5 = <&boot_a>;
+		part-6 = <&rsv>;
+		part-7 = <&vbmeta>;
+		part-8 = <&tee>;
+		part-9 = <&vendor>;
+		part-10 = <&system_a>;
+		part-11 = <&boot_b>;
+		part-12 = <&system_b>;
+		part-13 = <&recovery_b>;
+		part-14 = <&data>;
 
 		logo:logo{
 			pname = "logo";
 			size = <0x0 0x800000>;
 			mask = <1>;
 		};
-		recovery:recovery{
-			pname = "recovery";
+		recovery_a:recovery_a{
+			pname = "recovery_a";
 			size = <0x0 0x1800000>;
 			mask = <1>;
 		};
@@ -45,11 +43,6 @@
 			size = <0x0 0x800000>;
 			mask = <1>;
 		};
-		dtbo:dtbo{
-			pname = "dtbo";
-			size = <0x0 0x800000>;
-			mask = <1>;
-		};
 		cri_data:cri_data
 		{
 			pname = "cri_data";
@@ -61,11 +54,6 @@
 			size = <0x0 0x1000000>;
 			mask = <1>;
 		};
-		metadata:metadata{
-			pname = "metadata";
-			size = <0x0 0x1000000>;
-			mask = <1>;
-		};
 		vbmeta:vbmeta{
 			pname = "vbmeta";
 			size = <0x0 0x200000>;
@@ -76,9 +64,9 @@
 			size = <0x0 0x1000000>;
 			mask = <2>;
 		};
-		boot:boot
+		boot_a:boot_a
 		{
-			pname = "boot";
+			pname = "boot_a";
 			size = <0x0 0x1000000>;
 			mask = <1>;
 		};
@@ -93,28 +81,28 @@
 			size = <0x0 0x14000000>;
 			mask = <1>;
 		};
-		odm:odm
+		system_a:system_a
 		{
-			pname = "odm";
-			size = <0x0 0x8000000>;
+			pname = "system_a";
+			size = <0x0 0x50000000>;
 			mask = <1>;
 		};
-		system:system
+		boot_b:boot_b
 		{
-			pname = "system";
-			size = <0x0 0x50000000>;
+			pname = "boot_b";
+			size = <0x0 0x1000000>;
 			mask = <1>;
 		};
-		product:product{
-			pname = "product";
-			size = <0x0 0x8000000>;
+		system_b:system_b
+		{
+			pname = "system_b";
+			size = <0x0 0x50000000>;
 			mask = <1>;
 		};
-		cache:cache
-		{
-			pname = "cache";
-			size = <0x0 0x46000000>;
-			mask = <2>;
+		recovery_b:recovery_b{
+			pname = "recovery_b";
+			size = <0x0 0x1800000>;
+			mask = <1>;
 		};
 		data:data
 		{
diff --git a/arch/arm/boot/dts/amlogic/tm2_t962e2_ab311.dts b/arch/arm/boot/dts/amlogic/tm2_t962e2_ab311.dts
index e5a2e6d3cbbc..6a4cae37a9cb 100644
--- a/arch/arm/boot/dts/amlogic/tm2_t962e2_ab311.dts
+++ b/arch/arm/boot/dts/amlogic/tm2_t962e2_ab311.dts
@@ -18,7 +18,7 @@
 /dts-v1/;
 
 #include "mesontm2.dtsi"
-#include "partition_mbox_normal.dtsi"
+#include "partition_mbox_normal_P_32.dtsi"
 
 / {
 	model = "Amlogic TM2 T962E2 AB311";
diff --git a/arch/arm/boot/dts/amlogic/tm2_t962e2_ab311_drm.dts b/arch/arm/boot/dts/amlogic/tm2_t962e2_ab311_drm.dts
index d88f4bf88da5..e6687a583897 100644
--- a/arch/arm/boot/dts/amlogic/tm2_t962e2_ab311_drm.dts
+++ b/arch/arm/boot/dts/amlogic/tm2_t962e2_ab311_drm.dts
@@ -19,7 +19,7 @@
 
 #include "mesontm2.dtsi"
 #include "mesontm2_drm.dtsi"
-#include "partition_mbox_normal.dtsi"
+#include "partition_mbox_normal_P_32.dtsi"
 
 / {
 	model = "Amlogic TM2 T962E2 AB311";
diff --git a/arch/arm/boot/dts/amlogic/tm2_t962x3_ab301.dts b/arch/arm/boot/dts/amlogic/tm2_t962x3_ab301.dts
index a53ba643caf7..61b117c06176 100644
--- a/arch/arm/boot/dts/amlogic/tm2_t962x3_ab301.dts
+++ b/arch/arm/boot/dts/amlogic/tm2_t962x3_ab301.dts
@@ -18,7 +18,7 @@
 /dts-v1/;
 
 #include "mesontm2.dtsi"
-#include "partition_mbox_normal.dtsi"
+#include "partition_mbox_normal_P_32.dtsi"
 #include "mesontm2_t962x3_ab301-panel.dtsi"
 
 / {
diff --git a/arch/arm/boot/dts/amlogic/tm2_t962x3_ab301_drm_buildroot.dts b/arch/arm/boot/dts/amlogic/tm2_t962x3_ab301_drm_buildroot.dts
index 2b0b0c8555a7..fd2a22f178b1 100644
--- a/arch/arm/boot/dts/amlogic/tm2_t962x3_ab301_drm_buildroot.dts
+++ b/arch/arm/boot/dts/amlogic/tm2_t962x3_ab301_drm_buildroot.dts
@@ -19,7 +19,7 @@
 
 #include "mesontm2.dtsi"
 #include "mesontm2_drm.dtsi"
-#include "partition_mbox_normal.dtsi"
+#include "partition_mbox_normal_P_32.dtsi"
 #include "mesontm2_t962x3_ab301-panel.dtsi"
 
 / {
-- 
2.24.1

